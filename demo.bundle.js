!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","react-dom"],t):t(e.React,e.ReactDOM)}(this,function(i,e){"use strict";i=i&&i.hasOwnProperty("default")?i.default:i,e=e&&e.hasOwnProperty("default")?e.default:e;var c={};window.addEventListener("popstate",function(){var e=c.router;e&&e.update(e.location,e.queue.pop())});var o=function(e,t){return window.Promise?new Promise(e).then(t):e(t)},a=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},u=function(e,t){return"string"!=typeof t?t="":/^\//.test(t)||(t="/"+t),r(e||"")+t},r=function(e){return e.replace(/^(?=[^/])/,"/").replace(/\/+$/,"")},t=function(o){var a={};return function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.join(l);return r in a||(a[r]=o.apply(this,t)),a[r]}},l=Math.random(),s=t(function(e,t){return"/"==e?e+="(?=("+c.router.html+")?$)":/\/$/.test(e)?(e=e.slice(0,e.length-1),e+="(?=/?\\/|$)"):e&&(e+="(?=/?$)"),new RegExp("^"+e,t?void 0:"i")}),h=/:[\w-~]+(?=\/|$)/g,p="([\\w-~]+)",m=t(function(e,t){return s(e.replace(h,p),t)}),d=function(e,t,n){e&&(n=n.replace(m(e),""));var r=["pathname"],o={},a=t.replace(h,function(e){return r.push(e.slice(1)),p});return(s(a).exec(n)||[]).filter(Boolean).forEach(function(e,t){o[r[t]]=e}),o},f=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r="boolean"==typeof t[t.length-1]&&t.pop(),o=t.pop(),a=t.pop();return m(u(a,o),r).test(c.router.pathname)},v=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.pop(),o=t.pop();return d(o,r,c.router.pathname)},y="path must starts with / . Current path is: ",g="404 Not Found";/^zh-/.test(navigator.language)&&(g="404 找不到页面");var b=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},E=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},C=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},w=function(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},R=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},_=function(e){function n(e){b(this,n);var t=R(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.route={},t.matching={},t.cache={},t.group={},t[404]={},t.state=t.location,t.html=e.htmlFile||"index.html",t.queue=[],t[0]=history.length,history.replaceState&&history.replaceState({i:t[0]},""),t.match=f,t.params=v,c.router=t,e.global&&(window[e.global]=t),t}return C(n,e),E(n,[{key:"componentWillUnmount",value:function(){c.router=null}},{key:"componentDidMount",value:function(){this.sync(404)}},{key:"push",value:function(e,t){return this.change(1,e,t)}},{key:"replace",value:function(e,t){return this.change(0,e,t)}},{key:"change",value:function(e,t,n){/^\//.test(t)||console.error(new Error(y+t));var r,o=this.basename+t;return history.replaceState?(history[e?"pushState":"replaceState"]({i:history.state.i+e},"",o),this.update({pathname:(r=t.split("?"))[0],search:r[1]?"?"+r[1]:""},n)):(location.href=o,n&&n())}},{key:"update",value:function(t,e){var n=this;return o(function(e){n.group={},n.sync("route",t.pathname),n.setState(t,function(){n.sync(404),e()})},e)}},{key:"back",value:function(e,t){return this.moreHistory||!e?this.go(-1,t):this.replace(e,t)}},{key:"forward",value:function(e){return this.go(1,e)}},{key:"go",value:function(t,e){var n=this;return o(function(e){n.queue.unshift(e),history.go(t)},e)}},{key:"sync",value:function(e,t){a(this[e]).forEach(function(e){e.exec(t)})}},{key:"clearCache",value:function(t,e){var n=this;if(!/^\//.test(t))throw new Error(y+t);var r=a(this.cache).filter(function(e){return t==e.path});return o(function(e){r.length?(r.forEach(function(e){e.del("cache")}),n.forceUpdate(e)):(console.warn(new Error("clearCache could not find this path, please check your typein: "+t)),e())},e)}},{key:"render",value:function(){var e=this.props,t=e.C_,n=w(e,["C_"]);return delete n.basename,delete n.htmlFile,i.createElement(t,k({},n,{router:this}))}},{key:"basename",get:function(){return r(this.props.basename||"")}},{key:"pathname",get:function(){return"/"+this.html==this.state.pathname?"/":this.state.pathname}},{key:"location",get:function(){return{pathname:decodeURIComponent(location.pathname.replace(new RegExp("^"+this.basename),"")||"/"),search:location.search}}},{key:"moreHistory",get:function(){return!history.state||history.state.i>this[0]}}]),n}(i.Component),x=0,P=function(e){function a(e){b(this,a);var t=R(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e)),n=e.parentPath,r=e.path,o=e.autoCache;if(r&&!/^\//.test(r)&&console.error(new Error(y+r)),n&&!/\/$/.test(n))throw new Error("In nested routes, parent route must has a path ends with '/'. Current path is: "+n);return t.id=++x,t.path=u(n,r),t.wrap=o&&"nowrap"!=o,t.put("route"),t.exec(c.router.pathname),t}return C(a,e),E(a,[{key:"componentWillUnmount",value:function(){this.del("route"),this.del("matching"),this.del("cache"),this==this.core&&(this.core=null)}},{key:"exec",value:function(e){m(this.path,this.props.caseSensitive).test(e)?(this.put("matching"),this.core||(this.core=this),this==this.core&&this.props.autoCache&&this.put("cache"),this.params=d(this.props.parentPath,this.props.path,e)):(this.del("matching"),this==this.core&&(this.core=null),this.params={})}},{key:"get",value:function(e){return c.router[e][this.id]}},{key:"put",value:function(e){c.router[e][this.id]=this}},{key:"del",value:function(e){c.router[e][this.id]&&delete c.router[e][this.id]}},{key:"render",value:function(){var e=this.props,t=e.C_,n=e.title,r=null;return this.get("matching")&&this==this.core?(r=i.createElement(t,k({},this.params,this.pass)),this.wrap&&(r=i.createElement("div",null,r)),void 0!==n?document.title=n:void 0!==this.params.title&&(document.title=this.params.title)):this.get("cache")&&(r=i.createElement(t,k({},this.pass,{cached:!0})),this.wrap&&(r=i.createElement("div",{style:{display:"none"}},r))),r}},{key:"core",get:function(){return void 0===this.props.group?this:c.router.group[this.props.group]},set:function(e){if(void 0!==this.props.group)return c.router.group[this.props.group]=e}},{key:"pass",get:function(){var e=k({},this.props);return delete e.C_,delete e.parentPath,delete e.path,delete e.title,delete e.autoCache,delete e.caseSensitive,delete e.group,e.path=this.path,e.router=c.router,e}}]),a}(i.Component),O=0,j=i.createElement("div",{style:{display:"none"}}),S=function(e){function n(e){b(this,n);var t=R(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.id=++O,c.router[404][t.id]=t}return C(n,e),E(n,[{key:"componentWillUnmount",value:function(){delete c.router[404][this.id]}},{key:"exec",value:function(){this.i=!0,this.forceUpdate()}},{key:"render",value:function(){if(!this.i||!this[404])return j;var e=this.props,t=e.C_,n=e.title,r=void 0===n?g:n,o=w(e,["C_","title"]);return document.title=r,delete o.NotFound,delete o.notFound,delete o.Notfound,i.createElement(t,k({},o,c))}},{key:404,get:function(){var t=new RegExp("^"+(this.props.parentPath||"")),e=a(c.router.matching).filter(function(e){return e.path.match(t)}),n=e.filter(function(e){return e.path.replace(t,"")});return e.length>=!!this.props.parentPath&&!n.length}}]),n}(i.Component),n=function(n){return function(e){var t=void 0;return t=c.router?e.notFound||e.NotFound||e.Notfound?S:P:_,i.createElement(t,k({C_:n},e))}};(n.Routing=n).A=function(e){var r=e.redirect,o=e.onClick,a=e.href,t=e.children,n=w(e,["redirect","onClick","href","children"]);return i.createElement("a",k({href:c.router.basename+a,onClick:function(e){e.preventDefault();var t=function(){c.router[r?"replace":"push"](a)};if(!o)return t();var n=o(e);if(n&&n.then)return n.then(t);!1!==n&&t()}},n),t)},n.Async=function(r){return function(n){return function(e){function t(){return b(this,t),R(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return C(t,e),E(t,[{key:"componentDidMount",value:function(){var t=this;r().then(function(e){t.C_=e[n||"default"],t.forceUpdate()})}},{key:"render",value:function(){return this.C_?i.createElement(this.C_,this.props):null}}]),t}(i.Component)}};var D=function(e){var t=e.router,n=e.token,r=e.setToken;return i.createElement("nav",{id:"navigation-bar"},i.createElement("button",{name:"basic",onClick:function(){return t.push("/basic")}},"Basic Use"),i.createElement("button",{name:"parameter",onClick:function(){return t.push("/parameter/kuu/12")}},"URL Parameters "),i.createElement("button",{name:"cache",onClick:function(){return t.push("/cache")}},"Cache"),i.createElement("button",{name:"dynamic",onClick:function(){return t.push("/dynamic/")}},"Dynamic Routing"),i.createElement("button",{name:"notfound",onClick:function(){return t.push("/"+Math.random())}},"Not Found"),i.createElement("button",{name:"profile",onClick:function(){return t.push("/profile")}},"My Profile (Login)"),n&&i.createElement("button",{name:"logout",onClick:function(){r(null),t.push("/")}},"Logout"),i.createElement("br",null),i.createElement("div",null,i.createElement("span",{style:{fontSize:14}},"Exclusive Routing : "),i.createElement("button",{name:"one",onClick:function(){return t.push("/exclusive/one")}},"Render First Route"),i.createElement("button",{name:"two",onClick:function(){return t.push("/exclusive/two")}},"Render Second Route"),i.createElement("button",{name:"three",onClick:function(){return t.push("/exclusive/foobar")}},"Render Third Route")),i.createElement("br",null))},T=function(e){var t=e.id,n=e.data;return t,n,null};window.Log=T;var U=function(e){var t=document.getElementById("code");if(t&&t.remove(),e){var n=document.createElement("pre");n.id="code",n.className="prettyprint",n.innerText=e,document.body.appendChild(n),window.PR&&window.PR.prettyPrint()}},B="\nimport React from 'react';\nimport Routing from 'less-router';\n\nconst Home = () => (\n  <div id=\"home\">\n    Home\n  </div>\n);\n\nexport default Routing(Home);\n",L=n(function(){return U(B),i.createElement("div",{id:"home"},"Home")}),M="\n// app.jsx\nimport Basic from './basic';\n...\n<Basic path=\"/basic\" title=\"Basic Route\" />\n\n\n// basic.jsx\nimport React from 'react';\nimport Routing from 'less-router';\n\nconst Basic = ({ router }) => (\n  <div id=\"basic\">\n    Basic Route is match.\n    <br />\n    <button onClick={() => router.back('home')}>\n      Back to home page\n    </button>\n  </div>\n);\n\nexport default Routing(Basic);\n",F=n(function(e){var t=e.router;return U(M),i.createElement("div",{id:"basic"},"Basic Route is match.",i.createElement("br",null),i.createElement("button",{name:"basic-back",onClick:function(){return t.back("home")}},"Back to home page"),i.createElement(T,{id:"basic",data:{router:t}}))}),I='\n// app.jsx\nimport Parameter from \'./basic\';\n...\n<Parameter path="/parameter/:name/:id" title="URL Parameters" />\n\n\n// basic.jsx\nimport React from \'react\';\nimport Routing from \'less-router\';\n\nconst Parameter = ({ name, id }) => (\n  <div id="parameter">\n    URL Parameters:\n    <br />\n    name: {name}\n    <br />\n    id: {id}\n    <Log id="parameter" data={{ name, id }} />\n  </div>\n);\n\nexport default Routing(Basic);\n',$=n(function(e){var t=e.name,n=e.id;return U(I),i.createElement("div",{id:"parameter"},"URL Parameters:",i.createElement("br",null),"name: ",t,i.createElement("br",null),"id: ",n,i.createElement(T,{id:"parameter",data:{name:t,id:n}}))});T.cache={mount:0};var N=function(e){function n(e){b(this,n);var t=R(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={start:(new Date).toLocaleString(),count:0},t}return C(n,e),E(n,[{key:"componentDidMount",value:function(){var e=this;this.timer=setInterval(function(){e.setState({count:e.state.count+1})},1e3),T.cache.mount+=1}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){var t=this;this.props.pathname&&U(H);var e,n=this.props.router;return i.createElement("div",{id:"cache"},"Start Time: ",this.state.start,i.createElement("br",null),"Counting: ",this.state.count,i.createElement("br",null),i.createElement("button",{name:"clear-cache",onClick:(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.replace("/");case 2:return e.next=4,n.clearCache("/cache");case 4:console.log("clear");case 5:case"end":return e.stop()}},e,t)}),function(){var c=e.apply(this,arguments);return new Promise(function(a,i){return function t(e,n){try{var r=c[e](n),o=r.value}catch(e){return void i(e)}if(!r.done)return Promise.resolve(o).then(function(e){t("next",e)},function(e){t("throw",e)});a(o)}("next")})})},"Back to Home Page and Clear Cache"))}}]),n}(i.Component),H="\n// app.jsx\nimport Cache from './cache';\n...\n<Cache path=\"/cache\" title=\"Cache\" autoCache />\n\n// cache.jsx\nimport React from 'react';\nimport Routing from 'less-router';\n\nclass Cache extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      start: new Date().toLocaleString(),\n      count: 0,\n    };\n  }\n  componentDidMount() {\n    this.timer = setInterval(() => {\n      this.setState({\n        count: this.state.count + 1,\n      });\n    }, 1000);\n  }\n  componentWillUnmount() {\n    clearInterval(this.timer);\n  }\n  render() {\n    const { router } = this.props;\n    return (\n      <div id=\"cache\">\n        Start Time: {this.state.start}\n        <br />\n        Counting: {this.state.count}\n        <br />\n        <button name=\"clear-cache\" onClick={async () => {\n          await router.replace('/');\n          await router.clearCache('/cache');\n          console.log('clear');\n        }}>Back to Home Page and Clear Cache</button>\n      </div>\n    );\n  }\n}\n\nexport default Routing(Cache);\n",W=n(N),q="\n// child.jsx\nimport React from 'react';\nimport Routing from 'less-router';\n\nconst Child = ({ router }) => (\n  <div id=\"child\">\n    Child is rendered.\n  </div>\n);\n\nexport default Routing(Child);\n",A=n(function(e){e.router;return U(q),i.createElement("div",{id:"child"},"Child is rendered.")}),z='\n// app.jsx\nimport Dynamic from \'./dynamic\';\n...\n<Dynamic path="/dynamic/" title="Dynamic Routing" />\n\n// dynamic.jsx\nimport React from \'react\';\nimport Routing from \'less-router\';\nimport Child from \'./child\';\n\nconst Dynamic = ({ router, path, pathname }) => (\n  <div id="dynamic">\n    <Child parentPath={path} path="/child" />\n    <button\n      name="dynamic-child"\n      onClick={() => router.push(`${pathname}/child`)}\n    >\n      Show Child\n    </button>\n  </div>\n);\n\nexport default Routing(Dynamic);\n',V=n(function(e){var t=e.router,n=e.path,r=e.pathname;return U(z),i.createElement("div",{id:"dynamic"},i.createElement(A,{parentPath:n,path:"/child"}),i.createElement("button",{name:"dynamic-child",onClick:function(){return t.push(r+"/child")}},"Show Child"),i.createElement(T,{id:"dynamic",data:{router:t,path:n,pathname:r}}))}),G=n(function(e){e.router;return U(),i.createElement("div",{id:"one"},"One is rendered.")}),J=n(function(e){function n(e){b(this,n);var t=R(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={count:0},t}return C(n,e),E(n,[{key:"componentDidMount",value:function(){var e=this;this.timer=setInterval(function(){e.setState({count:e.state.count+1})},1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){var e=this.props.router;return i.createElement("div",{id:"two"},"Two is rendered.",i.createElement("br",null),"Two existed time: ",this.state.count," seconds",i.createElement("br",null),i.createElement("button",{onClick:function(){return e.back()}},"Back to home page"))}}]),n}(i.Component)),K=n(function(){return U(),i.createElement("div",{id:"three"},"Three is rendered.")}),Q=n(function(e){var t=e.router,n=e.setToken;return i.createElement("div",{id:"login"},i.createElement("label",null,"Username: ",i.createElement("input",{defaultValue:"kuu12"})),i.createElement("br",null),i.createElement("label",null,"Password: ",i.createElement("input",{type:"password",defaultValue:"foobar"})),i.createElement("br",null),i.createElement("button",{onClick:function(){n(!0),t.replace(sessionStorage.getItem("loginRedirect")||"/")}},"Submit"))}),X=function(e){function t(){return b(this,t),R(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return C(t,e),E(t,[{key:"componentDidMount",value:function(){this.props.token||(sessionStorage.setItem("loginRedirect","/profile"),this.props.router.push("/login"))}},{key:"render",value:function(){return U(Y),i.createElement("div",{id:"profile"},"My Profile",i.createElement("br",null),"balance: $ 100.00")}}]),t}(i.Component),Y="\nimport React from 'react';\nimport Routing from 'less-router';\n\nclass Profile extends React.Component {\n  componentDidMount() {\n    if (!this.props.token) {\n      sessionStorage.setItem('loginRedirect', '/profile');\n      this.props.router.push('/login');\n    }\n  }\n  render() {\n    return (\n      <div id=\"profile\">\n        My Profile\n        <br />\n        balance: $ 100.00\n    </div>\n    );\n  }\n}\n\nexport default Routing(Profile);\n",Z=n(X),ee=n(function(e){function t(){return b(this,t),R(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return C(t,e),E(t,[{key:"componentDidMount",value:function(){var e=this;this.timer=setTimeout(function(){e.props.router.replace("/")},3e3)}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer)}},{key:"render",value:function(){return U(),i.createElement("div",{id:"not-found"},"Nothing to show.",i.createElement("br",null),"Redirect to home page in 3 seconds...")}}]),t}(i.Component)),te=n(function(e){function n(e){b(this,n);var t=R(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={token:null},t.setToken=function(e){return t.setState({token:e})},window.debug_router=t.props.router,t}return C(n,e),E(n,[{key:"render",value:function(){var e=this.props.router;return i.createElement(i.Fragment,null,i.createElement("h4",null,"Demo of ",i.createElement("a",{href:"https://github.com/kuu12/less-router"},"Less-Router")),"/login"!==e.pathname&&i.createElement(D,{router:e,token:this.state.token,setToken:this.setToken}),i.createElement(ee,{notFound:!0,title:"404 Not Found"}),i.createElement(L,{path:"/"}),i.createElement(F,{path:"/basic",title:"Basic Route"}),i.createElement($,{path:"/parameter/:name/:id",title:"URL Parameters"}),i.createElement(W,{path:"/cache",title:"Cache",autoCache:!0}),i.createElement(V,{path:"/dynamic/",title:"Dynamic Routing"}),i.createElement(Q,{path:"/login",title:"Login",setToken:this.setToken}),i.createElement(Z,{path:"/profile",title:"profile",token:this.state.token}),i.createElement(G,{path:"/exclusive/one",title:"Exclusive Route 1",group:"1"}),i.createElement(J,{path:"/exclusive/two",title:"Exclusive Route 2",group:"1",autoCache:!0}),i.createElement(K,{path:"/exclusive/:any",title:"Exclusive Route 3",group:"1"}),i.createElement(T,{id:"app",data:this.props}))}}]),n}(i.Component)),ne=document.createElement("div");ne.id="root",document.body.appendChild(ne),e.render(i.createElement(te,{basename:"/less-router"}),ne)});
//# sourceMappingURL=demo.bundle.js.map
